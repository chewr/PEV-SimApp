import dynamic_trips
import pev_sim
import sim_util
import json

environs = {}


def Run(sim_uid, fleet, maxDist, freq, dur):
	start = 0
	if sim_uid in environs:
		env = environs[sim_uid]
		start = env.sim_end
		env.setFleetSize(fleet)
	else:
		global hubway_stations
		env = pev_sim.Sim_env(fleet, None, hubway_stations)
	end = start + dur
	pickups = dynamic_trips.TripRandomizer().assembleTripSim(maxDist, freq, maxDist, freq, start, end)
	env.scheduleIncremental(pickups, dur)
	environs[env.sim_uid] = env
	return json.dumps(env.getSegment(start, end, True), default=sim_util.default_json, separators=(',', ':'), indent=4)

hubway_stations = [(42.380287, -71.125107),
		 (42.377945, -71.116865),
		 (42.356954, -71.113687),
		 (42.376369, -71.114025),
		 (42.387995, -71.119084),
		 (42.366095, -71.086388),
		 (42.370803, -71.104412),
		 (42.397828, -71.130516),
		 (42.396969, -71.123024),
		 (42.385582, -71.113341),
		 (42.351821, -71.045461),
		 (42.341332, -71.076847),
		 (42.341522, -71.068922),
		 (42.331567, -71.094734),
		 (42.35977, -71.051601),
		 (42.345959, -71.082578),
		 (42.352175, -71.055547),
		 (42.359677, -71.059364),
		 (42.363732, -71.124565),
		 (42.345392, -71.069616),
		 (42.353334, -71.137313),
		 (42.309467, -71.115645),
		 (42.31309, -71.114175),
		 (42.320998, -71.110833),
		 (42.315692, -71.098634),
		 (42.310579, -71.107341),
		 (42.322913, -71.100164),
		 (42.339335, -71.13493),
		 (42.346563, -71.128374),
		 (42.362457, -71.08497),
		 (42.369832, -71.118201),
		 (42.351356, -71.059367),
		 (42.355596, -71.07278),
		 (42.347265, -71.088088),
		 (42.354979, -71.063348),
		 (42.340799, -71.081572),
		 (42.3281898, -71.0833545),
		 (42.3348756, -71.0790969),
		 (42.350989, -71.073644),
		 (42.350851, -71.089886),
		 (42.348717, -71.085954),
		 (42.378338, -71.048927),
		 (42.365942, -71.060515),
		 (42.374035, -71.101427),
		 (42.379011, -71.119945),
		 (42.366222, -71.059914),
		 (42.356975, -71.145442),
		 (42.36069, -71.070884),
		 (42.355402, -71.058087),
		 (42.333689, -71.120526),
		 (42.325941, -71.065928),
		 (42.362429, -71.090188),
		 (42.352409, -71.062679),
		 (42.350413, -71.07655),
		 (42.377022, -71.056605),
		 (42.366981, -71.076472),
		 (42.330825, -71.057007),
		 (42.340021, -71.100812),
		 (42.353412, -71.044624),
		 (42.320561, -71.06198),
		 (42.317225, -71.065421),
		 (42.336437, -71.073089),
		 (42.348762, -71.082383),
		 (42.328654, -71.084198),
		 (42.345733, -71.100694),
		 (42.335693, -71.045859),
		 (42.335741, -71.03877),
		 (42.330716, -71.057044),
		 (42.325333, -71.075354),
		 (42.338623, -71.074182),
		 (42.366231, -71.060868),
		 (42.349046, -71.096831),
		 (42.343912, -71.102221),
		 (42.348833, -71.041747),
		 (42.334073, -71.105221),
		 (42.357247, -71.146452),
		 (42.349673, -71.077303),
		 (42.354594, -71.05896),
		 (42.346171, -71.099855),
		 (42.360877, -71.07131),
		 (42.348323, -71.082674),
		 (42.340299, -71.109927),
		 (42.344023, -71.057054),
		 (42.3511, -71.0496),
		 (42.3475, -71.0441),
		 (42.348607, -71.13401),
		 (42.3581, -71.093198),
		 (42.36507, -71.1031),
		 (42.341598, -71.123338),
		 (42.361285, -71.06514),
		 (42.35892, -71.057629),
		 (42.371848, -71.060292),
		 (42.366277, -71.09169),
		 (42.3707, -71.07711),
		 (42.320494, -71.051122),
		 (42.311819, -71.035705),
		 (42.372969, -71.094445),
		 (42.375603, -71.064608),
		 (42.369182, -71.117152),
		 (42.373379, -71.111075),
		 (42.338629, -71.1065),
		 (42.350075, -71.105884),
		 (42.334057, -71.07403),
		 (42.335911, -71.088496),
		 (42.361667, -71.13802),
		 (42.337171, -71.102797),
		 (42.365074, -71.119581),
		 (42.347433, -71.076163),
		 (42.347527, -71.105828),
		 (42.36337, -71.129791),
		 (42.358508, -71.052984),
		 (42.356052, -71.069849),
		 (42.352261, -71.123831),
		 (42.356755, -71.055407),
		 (42.351146, -71.066289),
		 (42.343864, -71.085918),
		 (42.332799, -71.116205),
		 (42.360583, -71.056868),
		 (42.344763, -71.09788),
		 (42.352096, -71.070378),
		 (42.357143, -71.050699),
		 (42.363871, -71.050877),
		 (42.366621, -71.114214),
		 (42.341814, -71.090179),
		 (42.351313, -71.116174),
		 (42.402763, -71.126908),
		 (42.394002, -71.120406),
		 (42.40449, -71.123413),
		 (42.39082, -71.10942),
		 (42.400146, -71.112708),
		 (42.400877, -71.116772),
		 (42.386428, -71.096413),
		 (42.366426, -71.105495),
		 (42.363562, -71.10042),
		 (42.373268, -71.118579),
		 (42.373231, -71.120886),
		 (42.362613, -71.084105),
		 (42.383405, -71.107593),
		 (42.372244, -71.121851),
		 (42.378551, -71.106541),
		 (42.379637, -71.095319),
		 (42.362811, -71.056067)]
